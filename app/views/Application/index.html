#{extends 'main.html' /}
#{set title:'Home' /}

*{<!-- #{welcome /} -->}*
<div style="margin: 60px; width: 700px;">
    <div id="leftBlock" style="float: left">
        <div id="oauthInviteBlock">
            <span>Invite Friends</span>

            <div class="button"><a href="@{Invite.inviteGmail()}">Select from gmail</a></div>
            <div class="button"><a href="@{Invite.inviteFacebook()}">Select from facebook</a></div>
            <div class="button"><a href="@{Invite.inviteLinkedIn()}">Select from linkedin</a></div>
        </div>
        <div id="emailInput" style="margin-top: 20px;">
            <label for="emailAddress">Email</label><br>
            <input type="text" name="emailAddress" id="emailAddress" class="deletable">
            <span class="errormsg" id="emailError">Invalid email</span>
        </div>

        <div id="retrievedEmailAddresses" class="email-list" style="height: 100px; ">
            <ul>
            #{list items:contacts, as:'contact' }
                <li>${contact.email}, ${contact.name}</li>
            #{/list}
            </ul>
        </div>
    </div>
    <div id="rightBlock" style="float: right;">
        <div class="button"><a href="#">Invite</a></div>
        <div id="selectedEmailAddresses" class="email-list" style="height: 230px; ">
            <ul>

            </ul>
        </div>
    </div>
</div>

<script>

    var selectedEmailsSet = new Array();

    jQuery(document).ready(function() {
        jQuery('input.deletable').wrap('<span class="deleteicon" />').after(jQuery('<span/>').click(function() {
            jQuery(this).prev('input').val('').focus();
        }));
    });

    jQuery("#emailAddress").keyup(function(event) {
        var keyCode = event.keyCode;
        var $emailError = jQuery('#emailError');
        if (keyCode == 13) {
            var $input = jQuery(event.srcElement);
            var email = $input.val();
            if (validateEmail(email)) {
                if (selectedEmailsSet.indexOf(email) == -1) {
                    var $list = jQuery('#selectedEmailAddresses ul');
                    var $listElement = jQuery('<li>' + email + '</li>');
                    $listElement.appendTo($list);
                    $emailError.hide();
                    selectedEmailsSet.push(email);
                    $input.val('');
                }
            } else {
                $emailError.show();
            }
        }
    });

    function validateEmail(email) {
        var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    }

</script>


